name: .NET Cross-Platform Build

on:
  workflow_dispatch:
    inputs:
      build_mode:
        description: 'Build configuration'
        required: true
        default: 'debug'
        type: choice
        options: 
          - debug
          - release

jobs:
  build:
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
          path: 'src'  # æ˜¾å¼æŒ‡å®šæ£€å‡ºè·¯å¾„

      - name: ğŸ” æ™ºèƒ½é¡¹ç›®æŸ¥æ‰¾
        id: find_proj
        run: |
          # ä½¿ç”¨ç»å¯¹è·¯å¾„ + æ·±åº¦æœç´¢
          WORKSPACE="$GITHUB_WORKSPACE/src"  # åŒ¹é…æ£€å‡ºè·¯å¾„
          
          # æ‰©å±•æœç´¢æ¨¡å¼
          PROJECT_FILE=$(find "$WORKSPACE" \
            -iregex '.*\.csproj$' \
            -not -ipath '*/test/*' \
            -not -ipath '*/examples/*' \
            -print -quit)
          
          # å¤šçº§éªŒè¯
          if [[ ! -f "$PROJECT_FILE" ]]; then
            echo "::error::Critical: No valid .csproj found in:"
            find "$WORKSPACE" -name '*.*proj*' -exec echo '  --> {}' \;  # è°ƒè¯•è¾“å‡º
            exit 1
          fi
          
          echo "PROJ_PATH=${PROJECT_FILE#$WORKSPACE/}" >> $GITHUB_ENV
          echo "Found project at: ${{ env.PROJ_PATH }}"

      - name: ğŸ› ï¸ åŠ¨æ€æ„å»º
        run: dotnet build "${{ env.PROJ_PATH }}" --output ./bin
        env:
          DOTNET_CLI_UI_LANGUAGE: en  # å¼ºåˆ¶è‹±æ–‡è¾“å‡º
